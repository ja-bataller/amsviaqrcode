<!DOCTYPE html>
<html lang="en">
   <head>
      {{> _headerindex}}
   </head>
   <body>
      <div class="fixedContainer">
         <div id='stars'></div>
         <div id='stars2'></div>
         <div id='stars3'></div>
      </div>
      <div id='title'>
         <span>
         ATTENDANCE MONITORING SYSTEM 
         </span>
      </div>
      <div class="section">
         <div class="container">
            <div class="row full-height justify-content-center">
               <div class="col-12 text-center align-self-center py-5">
                  <div class="section pb-5 pt-5 pt-sm-2 text-center">
                     <h6 class="mb-0 pb-3"><span>Scan</span><span>Admin</span></h6>
                     <input class="checkbox" type="checkbox" id="reg-log" name="reg-log"/>
                     <label for="reg-log"></label>
                     <div class="card-3d-wrap mx-auto">
                        <div class="card-3d-wrapper">
                           <div class="card-front">
                              <div class="center-wrap">
                                 <div class="section text-center">
                                    <h4 class="mb-3">Scan QR Code</h4>
                                    <div class="videoContainer">
                                       <video id="qr-video" width="640" height="360"></video>
                                    </div>
                                    <div class="form-group">
                                       <span class="spanStyle" id="cam-qr-result"></span>
                                       <!-- <i class="input-icon uil uil-qrcode-scan"></i> -->
                                       <!-- <b>Last detected at: </b>
                                          <span id="cam-qr-result-timestamp"></span>
                                          <br> -->
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="card-back">
                              <div class="center-wrap">
                                 <div class="section text-center">
                                    <form>
                                       <h4 class="mb-4 pb-3">Administrator Log In</h4>
                                       <div class="form-group">
                                          <input type="text" id="username" name="username" class="form-style" placeholder="Your Username"  autocomplete="off" required>
                                          <i class="input-icon uil uil-user"></i>
                                       </div>
                                       <div class="form-group mt-2">
                                          <input type="password" id="password" name="password" class="form-style" placeholder="Your Password"  autocomplete="off" required>
                                          <i class="input-icon uil uil-lock-alt"></i>
                                       </div>
                                       <input class="btn mt-4" type="submit" value="log in">
                                    </form>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      {{> _footerindex}}

      <script>
      const form = document.querySelector('form');
      

      form.addEventListener('submit', async (e) => {
         e.preventDefault();

         // get values
         const username = form.username.value;
         const password = form.password.value;

         try {
            const res = await fetch('/', { 
            method: 'POST', 
            body: JSON.stringify({ username, password }),
            headers: {'Content-Type': 'application/json'}
            });
            const data = await res.json();
            console.log(data);
            
            // if the login inputs is incorrect this will trigger
            if (data.errors) {
               // if the login username input is incorrect
               if (data.errors.username) {
               iziToast.error({
                title: data.errors.username,
                message: "Unauthorized Access",
                position: "topCenter",
                timeout: 3000,
               });
               }
               // if the login password input is incorrect
               if (data.errors.password){
               iziToast.error({
               title: data.errors.password,
               message: "Unauthorized Access",
               position: "topCenter",
               timeout: 3000,
               });
               }
            }

            if (data.account) {
               iziToast.success({
                title: 'Login Success',
                message: "Authorized Access",
                position: "topCenter",
                timeout:2000,
            });
            setTimeout(function(){ let = baseURl = 
               location.assign('/admin'); }, 2000);
            }
         }
         catch (err) {
            console.log(err);
         }
      });
      </script>

   </body>
</html>