<!DOCTYPE html>
<html lang="en">
   <head>
    {{!-- partials header --}}
      {{> _header}}
   </head>
   <body id="page-top">

       {{!-- partials sidebar --}}
        {{> _sidebar}}

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

        {{!-- partials topbar --}}
         {{> _topbar}}

               <!-- Begin Page Content -->
               <div class="container-fluid">
                  <!-- Page Heading -->
                  <h2>Users</h2>
                  <a class="btn btn-success mb-3" href="/register" role="button"> <i class="fas fa-fw fa-user-plus"></i> Add New User</a>
                  <!-- DataTales Example -->
                  <div class="card shadow mb-4">
                  <!-- Modal -->
                  <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel aria-hidden="true" data-backdrop="static" data-keyboard="false""
                     aria-hidden="true">
                     <div class="modal-dialog" role="document">
                        <div class="modal-content">
                           <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel">Delete User?</h5>
                              <!-- <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">Ã—</span>
                              </button> -->
                           </div>
                           <div class="modal-body">Are you sure you want to delete this user?</div>
                           <div class="modal-footer">
                              <button class="btn btn-dark" type="button" data-dismiss="modal">No</button>
                              <a class="btn btn-danger" id="deleteUserDB">Yes</a>
                           </div>
                        </div>
                     </div>
                  </div>
                     <div class="card-body">
                        <div class="table-responsive">
                           <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                              <thead>
                                 <tr>
                                    <th>I.D #</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Department</th>
                                    <th>Contact No.</th>
                                    <th>Email Address</th>
                                    <th class="centerStyle">Actions</th>
                                    
                                 </tr>
                              </thead>
                              <tfoot>
                                 <tr>
                                    <th>I.D #</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Department</th>
                                    <th>Contact No.</th>
                                    <th>Email Address</th>
                                    <th class="centerStyle" width="5%">Actions</th>
                                    
                                 </tr>
                              </tfoot>
                              <tbody>
                                 {{#if users}}
                                    {{#each users}}
                                    <tr>
                                       <td>{{idnumber}}</td>
                                       <td>{{firstname}}</td>
                                       <td>{{lastname}}</td>
                                       <td>{{department}}</td>
                                       <td>{{contact_number}}</td>
                                       <td>{{email_address}}</td>
                                      <td>
                                         <div class="btn-group" >
                                             <a id="viewUser" href="/users/{{_id}}" class="btn btn-primary">
                                               <i class="fa fa-user"></i>
                                             </a>
                                             <button id="deleteUser" data-idnum="{{_id}}" class="btn btn-danger" href="#" data-toggle="modal" data-target="#deleteModal">
                                               <i class="fa fa-trash"></i>
                                             </button>
                                         </div>
                                      </td>
                                    </tr>
                                    {{/each}}
                                 {{/if}}
                              </tbody>
                           </table>
                           {{!-- <div class="d-flex justify-content-center">
                              <div class="spinner-border" role="status">
                              <span class="sr-only">Loading...</span>
                              </div>
                           </div> --}}
                        </div>
                     </div>
                  </div>
               </div>
               <!-- /.container-fluid -->
            </div>
            <!-- End of Main Content -->

         </div>
         <!-- End of Content Wrapper -->

      </div>
      <!-- End of Page Wrapper -->

      <!-- Scroll to Top Button-->
      <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
      </a>

      {{!-- partials logout modal --}}
      {{> _logoutmodal}}

    {{!-- partials footer --}}
      {{> _footer}}
      
      <script>
         const editUser = document.querySelector("#editUser");
         const deleteUser = document.querySelector("#deleteUser");
         const deleteUserDB = document.querySelector("#deleteUserDB")

         deleteUserDB.addEventListener("click", function() {
          const idNumDB = deleteUser.getAttribute('data-idnum');
          console.log(idNumDB);

          const endpoint = `/users/${idNumDB}`;
            fetch(endpoint, {
            method: 'DELETE',
            })
            .then(response => response.json())
            .then(data => {
               $("#deleteModal").modal("hide");

               iziToast.success({
               title: data.message,
               position: "topCenter",
               timeout:2000,
               });

               setTimeout(() => {
                  window.location.href = data.redirect;
               }, 2100)
               
            })
            .catch(err => console.log(err));
         });

      </script>
   </body>
</html>